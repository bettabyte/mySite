<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Basic Snake Game</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    canvas {
      background-color: #000;
      border: 1px solid #fff;
      width: 90vw;
      max-width: 400px;
      height: 90vw;
      max-height: 400px;
    }
    #settings {
      margin-top: 10px;
    }
    #score {
      margin-bottom: 10px;
    }
    #message {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1 id="score">Score: 0</h1>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div id="settings">
      <label for="gridSizeInput">Grid Size (e.g., 9 for 9x9): </label>
      <input type="number" id="gridSizeInput" value="9" min="5" max="50">
      <button id="updateGrid">Update Grid Size</button>
    </div>
    <p id="message">Press any key to start</p>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const scoreDisplay = document.getElementById("score");
      const messageDisplay = document.getElementById("message");
      const gridSizeInput = document.getElementById("gridSizeInput");
      const updateGridBtn = document.getElementById("updateGrid");

      let gridSize = parseInt(gridSizeInput.value) || 9;
      let cellSize = canvas.width / gridSize;
      let snake = [];
      let food = {};
      let direction = { x: 1, y: 0 };
      let nextDirection = { x: 1, y: 0 };
      let gameInterval;
      const gameSpeed = 200; // milliseconds per move
      let isGameOver = false;
      let isGameStarted = false;
      let canRestart = false;

      // Initialize the game state
      function initGame() {
        gridSize = parseInt(gridSizeInput.value) || 9;
        cellSize = canvas.width / gridSize;
        snake = [];
        // Place the snake's head in the center. The snake's body will extend to the left.
        const startX = Math.floor(gridSize / 2);
        const startY = Math.floor(gridSize / 2);
        // Loop backwards so that the head is at index 0.
        for (let i = 2; i >= 0; i--) {
          snake.unshift({ x: startX - i, y: startY });
        }
        // Now, snake[0] is the head at (startX, startY),
        // and the body occupies (startX-1, startY) and (startX-2, startY).
        // With a direction of {1, 0}, the snake will move to (startX+1, startY) on start.
        direction = { x: 1, y: 0 };
        nextDirection = { x: 1, y: 0 };
        placeFood();
        scoreDisplay.textContent = "Score: 0";
        isGameOver = false;
        isGameStarted = false;
        canRestart = false;
        messageDisplay.textContent = "Press any key to start";
        draw();
      }

      // Place the food at a random location that is not on the snake.
      function placeFood() {
        let valid = false;
        while (!valid) {
          food.x = Math.floor(Math.random() * gridSize);
          food.y = Math.floor(Math.random() * gridSize);
          valid = !snake.some(segment => segment.x === food.x && segment.y === food.y);
        }
      }

      // Main game loop: move snake, check collisions, update score, and redraw.
      function gameLoop() {
        direction = nextDirection;
        // Calculate new head position with wrap-around.
        const newHead = {
          x: (snake[0].x + direction.x + gridSize) % gridSize,
          y: (snake[0].y + direction.y + gridSize) % gridSize
        };

        // Check if the snake collides with itself.
        if (snake.some(segment => segment.x === newHead.x && segment.y === newHead.y)) {
          endGame();
          return;
        }

        snake.unshift(newHead);

        // If food is eaten, update score and place new food; otherwise, remove the tail.
        if (newHead.x === food.x && newHead.y === food.y) {
          scoreDisplay.textContent = "Score: " + (snake.length - 3);
          placeFood();
        } else {
          snake.pop();
        }
        draw();
      }

      // Draw snake and food on the canvas.
      function draw() {
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "red";
        ctx.fillRect(food.x * cellSize, food.y * cellSize, cellSize, cellSize);

        ctx.fillStyle = "green";
        snake.forEach(segment => {
          ctx.fillRect(segment.x * cellSize, segment.y * cellSize, cellSize, cellSize);
        });
      }

      // End the game and allow restart.
      function endGame() {
        clearInterval(gameInterval);
        isGameOver = true;
        isGameStarted = false;
        canRestart = true;
        messageDisplay.textContent = "Game Over! Press any key to restart.";
      }

      // Listen for key presses to control the snake and handle game start/restart.
      document.addEventListener("keydown", function(e) {
        if (isGameOver && canRestart) {
          initGame();
          isGameStarted = true;
          messageDisplay.textContent = "";
          gameInterval = setInterval(gameLoop, gameSpeed);
          canRestart = false;
          return;
        }

        // Control snake direction (arrow keys or WASD) while preventing reversal.
        if ((e.key === "ArrowUp" || e.key === "w" || e.key === "W") && direction.y !== 1) {
          nextDirection = { x: 0, y: -1 };
        } else if ((e.key === "ArrowDown" || e.key === "s" || e.key === "S") && direction.y !== -1) {
          nextDirection = { x: 0, y: 1 };
        } else if ((e.key === "ArrowLeft" || e.key === "a" || e.key === "A") && direction.x !== 1) {
          nextDirection = { x: -1, y: 0 };
        } else if ((e.key === "ArrowRight" || e.key === "d" || e.key === "D") && direction.x !== -1) {
          nextDirection = { x: 1, y: 0 };
        }

        // Start the game on the first key press if it hasn't started yet.
        if (!isGameStarted) {
          isGameStarted = true;
          messageDisplay.textContent = "";
          gameInterval = setInterval(gameLoop, gameSpeed);
        }
      });

      // Allow updating the grid size.
      updateGridBtn.addEventListener("click", function() {
        clearInterval(gameInterval);
        initGame();
      });

      // Initialize game on page load.
      initGame();
    });
  </script>
</body>
</html>
